// backend/src/seeds/examSeed.ts

import {
  PrismaClient,
  ExerciseType,
  Category,
  LiteraryEpoch,
} from "@prisma/client";
import { hash } from "bcrypt";

const prisma = new PrismaClient();

async function main() {
  console.log("üå± Rozpoczynam seed dla systemu egzaminacyjnego...");

  // 1. TWORZENIE STRUKTUR EGZAMINACYJNYCH (bez konkretnych pyta≈Ñ!)
  console.log("üìù Tworzƒô struktury egzamin√≥w...");

  await prisma.mockExam.create({
    data: {
      title: "Egzamin Maturalny 2025 - Poziom Podstawowy (Dynamiczny)",
      year: 2025,
      type: "PODSTAWOWY",
      duration: 240,
      isActive: true,
      sections: {
        create: [
          {
            order: 1,
            title: "Arkusz 1 - Czƒô≈õƒá 1: Jƒôzyk polski w u≈ºyciu",
            instruction:
              "Przeczytaj uwa≈ºnie teksty, a nastƒôpnie wykonaj zadania.",
            timeLimit: 45,
          },
          {
            order: 2,
            title: "Arkusz 1 - Czƒô≈õƒá 2: Test historycznoliteracki",
            instruction: "Wykonaj zadania. Odpowiadaj tylko w≈Çasnymi s≈Çowami.",
            timeLimit: 45,
          },
          {
            order: 3,
            title: "Arkusz 2 - Wypracowanie",
            instruction: "Wybierz jeden z temat√≥w i napisz wypracowanie.",
            timeLimit: 150,
          },
        ],
      },
    },
  });

  await prisma.mockExam.create({
    data: {
      title: "Egzamin Maturalny 2025 - Poziom Rozszerzony (Dynamiczny)",
      year: 2025,
      type: "ROZSZERZONY",
      duration: 300,
      isActive: true,
      sections: {
        create: [
          {
            order: 1,
            title: "Arkusz 1 - Czƒô≈õƒá 1: Jƒôzyk polski w u≈ºyciu",
            instruction: "Zaawansowane zadania jƒôzykowe.",
            timeLimit: 60,
          },
          {
            order: 2,
            title: "Arkusz 1 - Czƒô≈õƒá 2: Test historycznoliteracki",
            instruction: "Pog≈Çƒôbiona wiedza o literaturze.",
            timeLimit: 60,
          },
          {
            order: 3,
            title: "Arkusz 2 - Wypracowanie",
            instruction: "Zaawansowany temat wymagajƒÖcy g≈Çƒôbokiej analizy.",
            timeLimit: 180,
          },
        ],
      },
    },
  });

  console.log("‚úÖ Struktury egzamin√≥w utworzone!");

  // 2. TWORZENIE PULI PYTA≈É EGZAMINACYJNYCH
  console.log("üéØ Tworzƒô pulƒô pyta≈Ñ egzaminacyjnych...");

  // PYTANIA - JƒòZYK W U≈ªYCIU (poziom podstawowy)
  const jezykPytaniaPodstawowe = [
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.LANGUAGE_USE,
      difficulty: 2,
      question:
        "Wyja≈õnij znaczenie frazeologizmu 'mieƒá muchy w nosie' i podaj przyk≈Çad jego u≈ºycia.",
      tags: ["frazeologia", "jƒôzyk", "znaczenie"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.LANGUAGE_USE,
      difficulty: 2,
      question:
        "Przekszta≈Çƒá zdanie pojedyncze w z≈Ço≈ºone: 'Uczniowie czytajƒÖcy ksiƒÖ≈ºki rozwijajƒÖ wyobra≈∫niƒô.'",
      tags: ["sk≈Çadnia", "zdania", "przekszta≈Çcenia"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.LANGUAGE_USE,
      difficulty: 3,
      question:
        "Wyja≈õnij r√≥≈ºnicƒô miƒôdzy metaforƒÖ a por√≥wnaniem. Podaj po jednym przyk≈Çadzie.",
      tags: ["≈õrodki stylistyczne", "metafora", "por√≥wnanie"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SYNTHESIS_NOTE,
      category: Category.LANGUAGE_USE,
      difficulty: 3,
      question:
        "Na podstawie podanego fragmentu napisz notatkƒô syntetyzujƒÖcƒÖ g≈Ç√≥wne cechy stylu autora (60-90 s≈Ç√≥w).",
      tags: ["notatka", "styl", "synteza"],
      metadata: { isExamQuestion: true },
    },
  ];

  // PYTANIA ZAMKNIƒòTE z content
  const pytaniaZamkniete = [
    {
      type: ExerciseType.CLOSED_MULTIPLE,
      category: Category.LANGUAGE_USE,
      difficulty: 2,
      question:
        "Kt√≥re z podanych wyraz√≥w sƒÖ zapo≈ºyczeniami z jƒôzyka angielskiego?",
      content: {
        options: [
          "komputer",
          "marketing",
          "telefon",
          "weekend",
          "kawiarnia",
          "biznes",
        ],
      },
      correctAnswer: [0, 1, 3, 5],
      tags: ["zapo≈ºyczenia", "s≈Çownictwo"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.CLOSED_SINGLE,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 2,
      question: "W kt√≥rej epoce powsta≈Çy 'Dziady' Adama Mickiewicza?",
      content: {
        options: ["O≈õwiecenie", "Romantyzm", "Pozytywizm", "M≈Çoda Polska"],
      },
      correctAnswer: 1,
      tags: ["epoki", "romantyzm", "Mickiewicz"],
      metadata: { isExamQuestion: true },
      epoch: LiteraryEpoch.ROMANTICISM,
    },
    {
      type: ExerciseType.CLOSED_SINGLE,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 2,
      question: "Kto jest autorem 'Lalki'?",
      content: {
        options: [
          "Henryk Sienkiewicz",
          "Boles≈Çaw Prus",
          "W≈Çadys≈Çaw Reymont",
          "Stefan ≈ªeromski",
        ],
      },
      correctAnswer: 1,
      tags: ["pozytywizm", "powie≈õƒá", "Prus"],
      metadata: { isExamQuestion: true },
      epoch: LiteraryEpoch.POSITIVISM,
    },
    {
      type: ExerciseType.CLOSED_MULTIPLE,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 4,
      question:
        "Kt√≥re z podanych cech charakteryzujƒÖ poetykƒô awangardy Krakowskiej?",
      content: {
        options: [
          "Eksperyment formalny",
          "NawiƒÖzanie do tradycji",
          "Metaforyka",
          "Antyestetyzm",
          "Klasycyzm",
          "Urbanizm",
        ],
      },
      correctAnswer: [0, 2, 3, 5],
      tags: ["awangarda", "dwudziestolecie", "poezja"],
      metadata: { isExamQuestion: true },
      epoch: LiteraryEpoch.INTERWAR,
    },
  ];

  // PYTANIA HISTORYCZNOLITERACKIE (poziom podstawowy)
  const historycznoPytaniaPodstawowe = [
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 3,
      question: "Wyja≈õnij symbolikƒô tytu≈Çu 'Wesela' Stanis≈Çawa Wyspia≈Ñskiego.",
      tags: ["M≈Çoda Polska", "Wyspia≈Ñski", "symbolizm"],
      metadata: { isExamQuestion: true },
      epoch: LiteraryEpoch.YOUNG_POLAND,
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 3,
      question: "Opisz motyw wielkiej emigracji w literaturze romantycznej.",
      tags: ["romantyzm", "emigracja", "motywy"],
      metadata: { isExamQuestion: true },
      epoch: LiteraryEpoch.ROMANTICISM,
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 2,
      question: "Wymie≈Ñ trzy cechy gatunkowe ballady romantycznej.",
      tags: ["gatunki", "ballada", "romantyzm"],
      metadata: { isExamQuestion: true },
      epoch: LiteraryEpoch.ROMANTICISM,
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 3,
      question: "Por√≥wnaj kreacjƒô bohatera romantycznego i pozytywistycznego.",
      tags: ["bohater", "romantyzm", "pozytywizm"],
      metadata: { isExamQuestion: true },
    },
  ];

  // WYPRACOWANIA
  const wypracowania = [
    {
      type: ExerciseType.ESSAY,
      category: Category.WRITING,
      difficulty: 3,
      question:
        "Temat 1: Rola przyja≈∫ni w ≈ºyciu cz≈Çowieka. W pracy odwo≈Çaj siƒô do wybranej lektury obowiƒÖzkowej oraz innych tekst√≥w kultury.",
      tags: ["wypracowanie", "przyja≈∫≈Ñ", "lektura"],
      metadata: { isExamQuestion: true, minWords: 400 },
    },
    {
      type: ExerciseType.ESSAY,
      category: Category.WRITING,
      difficulty: 4,
      question:
        "Temat 2: Konflikt miƒôdzy jednostkƒÖ a spo≈Çecze≈Ñstwem w literaturze. Om√≥w problem na przyk≈Çadzie wybranych utwor√≥w.",
      tags: ["wypracowanie", "konflikt", "spo≈Çecze≈Ñstwo"],
      metadata: { isExamQuestion: true, minWords: 400 },
    },
    {
      type: ExerciseType.ESSAY,
      category: Category.WRITING,
      difficulty: 5,
      question:
        "Temat 3: Czy literatura mo≈ºe zmieniaƒá rzeczywisto≈õƒá? Rozwa≈º problem w kontek≈õcie wybranych utwor√≥w z r√≥≈ºnych epok.",
      tags: ["wypracowanie", "literatura zaanga≈ºowana", "epoki"],
      metadata: { isExamQuestion: true, minWords: 500 },
    },
    {
      type: ExerciseType.ESSAY,
      category: Category.WRITING,
      difficulty: 3,
      question:
        "Temat 4: Mi≈Ço≈õƒá jako ≈∫r√≥d≈Ço cierpienia i szczƒô≈õcia. Om√≥w zagadnienie na podstawie wybranych tekst√≥w.",
      tags: ["wypracowanie", "mi≈Ço≈õƒá", "uczucia"],
      metadata: { isExamQuestion: true, minWords: 400 },
    },
    {
      type: ExerciseType.ESSAY,
      category: Category.WRITING,
      difficulty: 4,
      question:
        "Temat 5: Motyw wƒôdr√≥wki w literaturze. Przedstaw r√≥≈ºne jej znaczenia i funkcje.",
      tags: ["wypracowanie", "wƒôdr√≥wka", "motyw"],
      metadata: { isExamQuestion: true, minWords: 400 },
    },
  ];

  // PYTANIA ROZSZERZONE
  const pytaniaRozszerzone = [
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.LANGUAGE_USE,
      difficulty: 4,
      question:
        "Przeanalizuj funkcje stylistyczne anafor w podanym fragmencie poetyckim.",
      tags: ["stylistyka", "anafora", "poezja"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.LANGUAGE_USE,
      difficulty: 5,
      question:
        "Wyja≈õnij zjawisko neosemantyzacji na przyk≈Çadzie wsp√≥≈Çczesnego jƒôzyka polskiego.",
      tags: ["jƒôzykoznawstwo", "neosemantyzacja", "wsp√≥≈Çczesno≈õƒá"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SYNTHESIS_NOTE,
      category: Category.LANGUAGE_USE,
      difficulty: 4,
      question:
        "Por√≥wnaj style wypowiedzi w dw√≥ch podanych fragmentach publicystycznych (80-120 s≈Ç√≥w).",
      tags: ["publicystyka", "styl", "por√≥wnanie"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 4,
      question: "Om√≥w recepcjƒô 'Dziad√≥w' w r√≥≈ºnych epokach literackich.",
      tags: ["Dziady", "recepcja", "epoki"],
      metadata: { isExamQuestion: true },
    },
    {
      type: ExerciseType.SHORT_ANSWER,
      category: Category.HISTORICAL_LITERARY,
      difficulty: 5,
      question:
        "Por√≥wnaj koncepcjƒô tragizmu w dramatach antycznych i romantycznych.",
      tags: ["tragizm", "dramat", "komparatystyka"],
      metadata: { isExamQuestion: true },
    },
  ];

  // Dodaj pytania - tylko otwarte (bez epoch)
  for (const pytanie of jezykPytaniaPodstawowe) {
    await prisma.exercise.create({
      data: {
        type: pytanie.type,
        category: pytanie.category,
        difficulty: pytanie.difficulty,
        question: pytanie.question,
        tags: pytanie.tags,
        metadata: pytanie.metadata,
        content: {},
        points:
          pytanie.type === ExerciseType.SYNTHESIS_NOTE
            ? 4
            : pytanie.type === ExerciseType.SHORT_ANSWER
            ? 2
            : 1,
      },
    });
  }

  // Dodaj pytania historycznoliterackie z epoch
  for (const pytanie of historycznoPytaniaPodstawowe) {
    await prisma.exercise.create({
      data: {
        type: pytanie.type,
        category: pytanie.category,
        difficulty: pytanie.difficulty,
        question: pytanie.question,
        tags: pytanie.tags,
        metadata: pytanie.metadata,
        content: {},
        points: 2,
        epoch: pytanie.epoch || null,
      },
    });
  }

  // Dodaj pytania zamkniƒôte
  for (const pytanie of pytaniaZamkniete) {
    await prisma.exercise.create({
      data: {
        type: pytanie.type,
        category: pytanie.category,
        difficulty: pytanie.difficulty,
        question: pytanie.question,
        tags: pytanie.tags,
        metadata: pytanie.metadata,
        content: pytanie.content,
        correctAnswer: pytanie.correctAnswer,
        points: pytanie.type === ExerciseType.CLOSED_MULTIPLE ? 2 : 1,
        epoch: pytanie.epoch || null,
      },
    });
  }

  // Dodaj wypracowania
  for (const wypracowanie of wypracowania) {
    await prisma.exercise.create({
      data: {
        type: wypracowanie.type,
        category: wypracowanie.category,
        difficulty: wypracowanie.difficulty,
        question: wypracowanie.question,
        tags: wypracowanie.tags,
        metadata: wypracowanie.metadata,
        content: {},
        points:
          wypracowanie.difficulty === 3
            ? 35
            : wypracowanie.difficulty === 4
            ? 38
            : 40,
      },
    });
  }

  // Dodaj pytania rozszerzone
  for (const pytanie of pytaniaRozszerzone) {
    await prisma.exercise.create({
      data: {
        type: pytanie.type,
        category: pytanie.category,
        difficulty: pytanie.difficulty,
        question: pytanie.question,
        tags: pytanie.tags,
        metadata: pytanie.metadata,
        content: {},
        points: pytanie.type === ExerciseType.SYNTHESIS_NOTE ? 5 : 3,
      },
    });
  }

  const totalQuestions =
    jezykPytaniaPodstawowe.length +
    pytaniaZamkniete.length +
    historycznoPytaniaPodstawowe.length +
    wypracowania.length +
    pytaniaRozszerzone.length;

  console.log(`‚úÖ Utworzono ${totalQuestions} pyta≈Ñ egzaminacyjnych!`);

  // 3. UTW√ìRZ PRZYK≈ÅADOWEGO U≈ªYTKOWNIKA
  console.log("üë§ Sprawdzam u≈ºytkownika testowego...");

  const existingUser = await prisma.user.findUnique({
    where: { email: "student@test.pl" },
  });

  if (!existingUser) {
    const hashedPassword = await hash("test123", 10);

    await prisma.user.create({
      data: {
        email: "student@test.pl",
        password: hashedPassword,
        firstName: "Jan",
        lastName: "Testowy",
        role: "STUDENT",
        profile: {
          create: {
            level: 3,
            totalPoints: 0,
            averageScore: 0,
          },
        },
      },
    });

    console.log(
      "‚úÖ U≈ºytkownik testowy utworzony (email: student@test.pl, has≈Ço: test123)"
    );
  } else {
    console.log("‚ÑπÔ∏è U≈ºytkownik testowy ju≈º istnieje");
  }

  console.log("\nüéâ Seed zako≈Ñczony pomy≈õlnie!");
  console.log("üìä Statystyki:");
  console.log(`   - Struktury egzamin√≥w: 2`);
  console.log(`   - Pytania egzaminacyjne: ${totalQuestions}`);
  console.log(`   - U≈ºytkownicy testowi: 1`);
}

main()
  .catch((e) => {
    console.error("‚ùå B≈ÇƒÖd podczas seedowania:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
