// backend/src/seeds/examSeed.ts

import { PrismaClient } from "@prisma/client";
import { hash } from "bcrypt";

const prisma = new PrismaClient();

async function main() {
  console.log("üå± Rozpoczynam seed dla systemu egzaminacyjnego...");

  // 1. TWORZENIE STRUKTUR EGZAMINACYJNYCH (bez konkretnych pyta≈Ñ!)
  console.log("üìù Tworzƒô struktury egzamin√≥w...");

  const examPodstawowy = await prisma.mockExam.create({
    data: {
      title: "Egzamin Maturalny 2025 - Poziom Podstawowy (Dynamiczny)",
      year: 2025,
      type: "PODSTAWOWY",
      duration: 240,
      isActive: true,
      sections: {
        create: [
          {
            order: 1,
            title: "Arkusz 1 - Czƒô≈õƒá 1: Jƒôzyk polski w u≈ºyciu",
            instruction:
              "Przeczytaj uwa≈ºnie teksty, a nastƒôpnie wykonaj zadania.",
            timeLimit: 45,
            // NIE dodajemy questions - system dobierze je dynamicznie!
          },
          {
            order: 2,
            title: "Arkusz 1 - Czƒô≈õƒá 2: Test historycznoliteracki",
            instruction: "Wykonaj zadania. Odpowiadaj tylko w≈Çasnymi s≈Çowami.",
            timeLimit: 45,
          },
          {
            order: 3,
            title: "Arkusz 2 - Wypracowanie",
            instruction: "Wybierz jeden z temat√≥w i napisz wypracowanie.",
            timeLimit: 150,
          },
        ],
      },
    },
  });

  const examRozszerzony = await prisma.mockExam.create({
    data: {
      title: "Egzamin Maturalny 2025 - Poziom Rozszerzony (Dynamiczny)",
      year: 2025,
      type: "ROZSZERZONY",
      duration: 300,
      isActive: true,
      sections: {
        create: [
          {
            order: 1,
            title: "Arkusz 1 - Czƒô≈õƒá 1: Jƒôzyk polski w u≈ºyciu",
            instruction: "Zaawansowane zadania jƒôzykowe.",
            timeLimit: 60,
          },
          {
            order: 2,
            title: "Arkusz 1 - Czƒô≈õƒá 2: Test historycznoliteracki",
            instruction: "Pog≈Çƒôbiona wiedza o literaturze.",
            timeLimit: 60,
          },
          {
            order: 3,
            title: "Arkusz 2 - Wypracowanie",
            instruction: "Zaawansowany temat wymagajƒÖcy g≈Çƒôbokiej analizy.",
            timeLimit: 180,
          },
        ],
      },
    },
  });

  console.log("‚úÖ Struktury egzamin√≥w utworzone!");

  // 2. TWORZENIE PULI PYTA≈É EGZAMINACYJNYCH
  console.log("üéØ Tworzƒô pulƒô pyta≈Ñ egzaminacyjnych...");

  // PYTANIA - JƒòZYK W U≈ªYCIU (poziom podstawowy)
  const jezykPytaniaPodstawowe = [
    {
      type: "SHORT_ANSWER",
      category: "LANGUAGE_USE",
      difficulty: 2,
      question:
        "Wyja≈õnij znaczenie frazeologizmu 'mieƒá muchy w nosie' i podaj przyk≈Çad jego u≈ºycia.",
      correctAnswer: null, // Oceniane przez AI
      tags: ["frazeologia", "jƒôzyk", "znaczenie"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SHORT_ANSWER",
      category: "LANGUAGE_USE",
      difficulty: 2,
      question:
        "Przekszta≈Çƒá zdanie pojedyncze w z≈Ço≈ºone: 'Uczniowie czytajƒÖcy ksiƒÖ≈ºki rozwijajƒÖ wyobra≈∫niƒô.'",
      correctAnswer: null,
      tags: ["sk≈Çadnia", "zdania", "przekszta≈Çcenia"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SHORT_ANSWER",
      category: "LANGUAGE_USE",
      difficulty: 3,
      question:
        "Wyja≈õnij r√≥≈ºnicƒô miƒôdzy metaforƒÖ a por√≥wnaniem. Podaj po jednym przyk≈Çadzie.",
      correctAnswer: null,
      tags: ["≈õrodki stylistyczne", "metafora", "por√≥wnanie"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SYNTHESIS_NOTE",
      category: "LANGUAGE_USE",
      difficulty: 3,
      question:
        "Na podstawie podanego fragmentu napisz notatkƒô syntetyzujƒÖcƒÖ g≈Ç√≥wne cechy stylu autora (60-90 s≈Ç√≥w).",
      correctAnswer: null,
      tags: ["notatka", "styl", "synteza"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "CLOSED_MULTIPLE",
      category: "LANGUAGE_USE",
      difficulty: 2,
      question:
        "Kt√≥re z podanych wyraz√≥w sƒÖ zapo≈ºyczeniami z jƒôzyka angielskiego?",
      content: {
        options: [
          "komputer",
          "marketing",
          "telefon",
          "weekend",
          "kawiarnia",
          "biznes",
        ],
        correctAnswer: [0, 1, 3, 5], // komputer, marketing, weekend, biznes
      },
      tags: ["zapo≈ºyczenia", "s≈Çownictwo"],
      metadata: { isExamQuestion: true },
    },
  ];

  // PYTANIA - HISTORYCZNOLITERACKIE (poziom podstawowy)
  const historycznoPytaniaPodstawowe = [
    {
      type: "CLOSED_SINGLE",
      category: "HISTORICAL_LITERARY",
      difficulty: 2,
      question: "W kt√≥rej epoce powsta≈Çy 'Dziady' Adama Mickiewicza?",
      content: {
        options: ["O≈õwiecenie", "Romantyzm", "Pozytywizm", "M≈Çoda Polska"],
        correctAnswer: 1, // Romantyzm
      },
      tags: ["epoki", "romantyzm", "Mickiewicz"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "CLOSED_SINGLE",
      category: "HISTORICAL_LITERARY",
      difficulty: 2,
      question: "Kto jest autorem 'Lalki'?",
      content: {
        options: [
          "Henryk Sienkiewicz",
          "Boles≈Çaw Prus",
          "W≈Çadys≈Çaw Reymont",
          "Stefan ≈ªeromski",
        ],
        correctAnswer: 1, // Boles≈Çaw Prus
      },
      tags: ["pozytywizm", "powie≈õƒá", "Prus"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SHORT_ANSWER",
      category: "HISTORICAL_LITERARY",
      difficulty: 3,
      question: "Wyja≈õnij symbolikƒô tytu≈Çu 'Wesela' Stanis≈Çawa Wyspia≈Ñskiego.",
      correctAnswer: null, // Oceniane przez AI
      tags: ["M≈Çoda Polska", "Wyspia≈Ñski", "symbolizm"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SHORT_ANSWER",
      category: "HISTORICAL_LITERARY",
      difficulty: 3,
      question: "Opisz motyw wielkiej emigracji w literaturze romantycznej.",
      correctAnswer: null,
      tags: ["romantyzm", "emigracja", "motywy"],
      metadata: { isExamQuestion: true },
    },
  ];

  // PYTANIA - WYPRACOWANIA (r√≥≈ºne poziomy)
  const wypracowania = [
    {
      type: "ESSAY",
      category: "WRITING",
      difficulty: 3,
      question:
        "Temat 1: Rola przyja≈∫ni w ≈ºyciu cz≈Çowieka. W pracy odwo≈Çaj siƒô do wybranej lektury obowiƒÖzkowej oraz innych tekst√≥w kultury.",
      correctAnswer: null, // Oceniane przez AI
      tags: ["wypracowanie", "przyja≈∫≈Ñ", "lektura"],
      metadata: { isExamQuestion: true, minWords: 400 },
    },
    {
      type: "ESSAY",
      category: "WRITING",
      difficulty: 4,
      question:
        "Temat 2: Konflikt miƒôdzy jednostkƒÖ a spo≈Çecze≈Ñstwem w literaturze. Om√≥w problem na przyk≈Çadzie wybranych utwor√≥w.",
      correctAnswer: null,
      tags: ["wypracowanie", "konflikt", "spo≈Çecze≈Ñstwo"],
      metadata: { isExamQuestion: true, minWords: 400 },
    },
    {
      type: "ESSAY",
      category: "WRITING",
      difficulty: 5,
      question:
        "Temat 3: Czy literatura mo≈ºe zmieniaƒá rzeczywisto≈õƒá? Rozwa≈º problem w kontek≈õcie wybranych utwor√≥w z r√≥≈ºnych epok.",
      correctAnswer: null,
      tags: ["wypracowanie", "literatura zaanga≈ºowana", "epoki"],
      metadata: { isExamQuestion: true, minWords: 500 },
    },
  ];

  // PYTANIA DLA POZIOMU ROZSZERZONEGO
  const jezykPytaniaRozszerzone = [
    {
      type: "SHORT_ANSWER",
      category: "LANGUAGE_USE",
      difficulty: 4,
      question:
        "Przeanalizuj funkcje stylistyczne anafor w podanym fragmencie poetyckim.",
      correctAnswer: null,
      tags: ["stylistyka", "anafora", "poezja"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SHORT_ANSWER",
      category: "LANGUAGE_USE",
      difficulty: 5,
      question:
        "Wyja≈õnij zjawisko neosemantyzacji na przyk≈Çadzie wsp√≥≈Çczesnego jƒôzyka polskiego.",
      correctAnswer: null,
      tags: ["jƒôzykoznawstwo", "neosemantyzacja", "wsp√≥≈Çczesno≈õƒá"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SYNTHESIS_NOTE",
      category: "LANGUAGE_USE",
      difficulty: 4,
      question:
        "Por√≥wnaj style wypowiedzi w dw√≥ch podanych fragmentach publicystycznych (80-120 s≈Ç√≥w).",
      correctAnswer: null,
      tags: ["publicystyka", "styl", "por√≥wnanie"],
      metadata: { isExamQuestion: true },
    },
  ];

  const historycznoPytaniaRozszerzone = [
    {
      type: "SHORT_ANSWER",
      category: "HISTORICAL_LITERARY",
      difficulty: 4,
      question: "Om√≥w recepcjƒô 'Dziad√≥w' w r√≥≈ºnych epokach literackich.",
      correctAnswer: null,
      tags: ["Dziady", "recepcja", "epoki"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "SHORT_ANSWER",
      category: "HISTORICAL_LITERARY",
      difficulty: 5,
      question:
        "Por√≥wnaj koncepcjƒô tragizmu w dramatach antycznych i romantycznych.",
      correctAnswer: null,
      tags: ["tragizm", "dramat", "komparatystyka"],
      metadata: { isExamQuestion: true },
    },
    {
      type: "CLOSED_MULTIPLE",
      category: "HISTORICAL_LITERARY",
      difficulty: 4,
      question:
        "Kt√≥re z podanych cech charakteryzujƒÖ poetykƒô awangardy Krakowskiej?",
      content: {
        options: [
          "Eksperyment formalny",
          "NawiƒÖzanie do tradycji",
          "Metaforyka",
          "Antyestetyzm",
          "Klasycyzm",
          "Urbanizm",
        ],
        correctAnswer: [0, 2, 3, 5], // Eksperyment, Metaforyka, Antyestetyzm, Urbanizm
      },
      tags: ["awangarda", "dwudziestolecie", "poezja"],
      metadata: { isExamQuestion: true },
    },
  ];

  // Dodaj wszystkie pytania do bazy
  const wszystkiePytania = [
    ...jezykPytaniaPodstawowe,
    ...historycznoPytaniaPodstawowe,
    ...wypracowania,
    ...jezykPytaniaRozszerzone,
    ...historycznoPytaniaRozszerzone,
  ];

  for (const pytanie of wszystkiePytania) {
    await prisma.exercise.create({
      data: {
        ...pytanie,
        content: pytanie.content || {},
        correctAnswer: pytanie.correctAnswer,
      },
    });
  }

  console.log(`‚úÖ Utworzono ${wszystkiePytania.length} pyta≈Ñ egzaminacyjnych!`);

  // 3. UTW√ìRZ PRZYK≈ÅADOWEGO U≈ªYTKOWNIKA (opcjonalne)
  console.log("üë§ Tworzƒô u≈ºytkownika testowego...");

  const hashedPassword = await hash("test123", 10);

  const testUser = await prisma.user.create({
    data: {
      email: "student@test.pl",
      password: hashedPassword,
      firstName: "Jan",
      lastName: "Testowy",
      role: "STUDENT",
      profile: {
        create: {
          level: 3,
          totalPoints: 0,
          streakDays: 0,
          averageScore: 0,
        },
      },
    },
  });

  console.log(
    "‚úÖ U≈ºytkownik testowy utworzony (email: student@test.pl, has≈Ço: test123)"
  );

  console.log("\nüéâ Seed zako≈Ñczony pomy≈õlnie!");
  console.log("üìä Statystyki:");
  console.log(`   - Struktury egzamin√≥w: 2`);
  console.log(`   - Pytania egzaminacyjne: ${wszystkiePytania.length}`);
  console.log(`   - U≈ºytkownicy testowi: 1`);
}

main()
  .catch((e) => {
    console.error("‚ùå B≈ÇƒÖd podczas seedowania:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
